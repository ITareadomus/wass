ðŸ” Dove sta il bug

Nel file:

TaskFlowMaster/client/src/pages/system-settings.tsx

la funzione handleClientToggle Ã¨ cosÃ¬:

handleClientToggle = (clientId: number, type: "eo" | "hp") => {
  setSettings(prevSettings => {
    if (!prevSettings) return null;
    const currentClients = prevSettings[type === "eo" ? "early-out" : "high-priority"].eo_clients || [];
    const updatedClients = currentClients.includes(clientId)
      ? currentClients.filter(id => id !== clientId)
      : [...currentClients, clientId];

    return {
      ...prevSettings,
      [type === "eo" ? "early-out" : "high-priority"]: {
        ...(type === "eo" ? prevSettings["early-out"] : prevSettings["high-priority"]),
        eo_clients: updatedClients,
      },
    };
  });
};


ðŸ‘‰ Qui stai sempre leggendo e scrivendo eo_clients, sia per "early-out" che per "high-priority".
Risultato: dentro "high-priority" ti finisce una chiave eo_clients, come vedi nel tuo settings.json.

âœ… Come deve essere

Devi aggiornare eo_clients solo per early-out e **hp_clients solo per high-priority`.

Sostituisci lâ€™intera handleClientToggle con questa versione:

const handleClientToggle = (clientId: number, type: "eo" | "hp") => {
  setSettings(prevSettings => {
    if (!prevSettings) return null;

    if (type === "eo") {
      const currentClients = prevSettings["early-out"].eo_clients || [];
      const updatedClients = currentClients.includes(clientId)
        ? currentClients.filter(id => id !== clientId)
        : [...currentClients, clientId];

      return {
        ...prevSettings,
        "early-out": {
          ...prevSettings["early-out"],
          eo_clients: updatedClients,
        },
      };
    } else {
      const currentClients = prevSettings["high-priority"].hp_clients || [];
      const updatedClients = currentClients.includes(clientId)
        ? currentClients.filter(id => id !== clientId)
        : [...currentClients, clientId];

      return {
        ...prevSettings,
        "high-priority": {
          ...prevSettings["high-priority"],
          hp_clients: updatedClients,
        },
      };
    }
  });
};


CosÃ¬:

per type === "eo" â†’ aggiorni early-out.eo_clients

per type === "hp" â†’ aggiorni high-priority.hp_clients

non scriverai piÃ¹ eo_clients dentro "high-priority" âœ…