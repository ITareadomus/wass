Perfetto âœ…
Ecco **cosa dire esattamente allâ€™AI (o allo sviluppatore)** per risolvere il problema e mantenere la **task 777 â€œstraordinariaâ€ (rossa)** in timeline.

---

## ğŸ”§ Messaggio da dare allâ€™AI

> Nel codice del progetto, applica queste modifiche:
>
> ---
>
> ### 1ï¸âƒ£ In `client/src/components/drag-drop/task-card.tsx`
>
> 1. Subito dentro al componente, aggiungi questo blocco per normalizzare `confirmed_operation` e il tipo della task:
>
>    ```ts
>    const rawConfirmed = (task as any).confirmed_operation;
>    const isConfirmedOperation =
>      typeof rawConfirmed === "boolean"
>        ? rawConfirmed
>        : typeof rawConfirmed === "number"
>          ? rawConfirmed !== 0
>          : typeof rawConfirmed === "string"
>            ? ["true", "1", "yes"].includes(rawConfirmed.toLowerCase().trim())
>            : false;
>
>    const taskType = String((task as any).type ?? (task as any).task_type ?? "")
>      .toLowerCase()
>      .trim();
>    ```
>
> 2. Crea una funzione che assegna **il colore e la label** solo in base al tipo task:
>
>    ```ts
>    const getTaskTypeStyle = (type: string) => {
>      switch (type) {
>        case "standard":
>          return { label: "standard", colorClass: "bg-emerald-100 text-emerald-800" }; // verde
>        case "premium":
>          return { label: "premium", colorClass: "bg-amber-100 text-amber-800" }; // oro
>        case "straordinaria":
>        case "extra":
>          return { label: "straordinaria", colorClass: "bg-rose-100 text-rose-800" }; // rosso
>        default:
>          return { label: "-", colorClass: "bg-gray-100 text-gray-700" };
>      }
>    };
>    const { label: typeLabel, colorClass } = getTaskTypeStyle(taskType);
>    ```
>
> 3. Nel render della card (timeline o container), mostra:
>
>    ```tsx
>    {/* Badge principale in base al tipo */}
>    <span className={`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${colorClass}`}>
>      {typeLabel}
>    </span>
>
>    {/* Chip tipologia intervento = mostra solo l'ID */}
>    <span className="inline-flex items-center rounded-md border px-2 py-0.5 text-xs text-muted-foreground">
>      {(task as any).operation_id ?? "-"}
>    </span>
>
>    {/* Punto di domanda se non confermato */}
>    {!isConfirmedOperation && (
>      <div className="absolute top-0.5 right-0.5 z-50">
>        <HelpCircle className="w-3 h-3 text-gray-900" strokeWidth={2.5} />
>      </div>
>    )}
>    ```
>
> ---
>
> ### 2ï¸âƒ£ Nel popup â€œTipologia interventoâ€
>
> Lascia **esattamente** questa logica:
>
> ```tsx
> <p className="text-sm">
>   {!isConfirmedOperation ? "non migrato" : (task as any).operation_id ?? "-"}
> </p>
> ```
>
> ---
>
> ### 3ï¸âƒ£ Rimuovi qualunque fallback tipo:
>
> ```ts
> task.type = task.type || "standard";
> ```
>
> o qualunque logica che deduce il tipo dal `operation_id`.
> Il tipo (`standard`, `premium`, `straordinaria`) deve venire solo dal campo `task.type` o `task.task_type`.
>
> ---
>
> âœ… **Risultato atteso:**
>
> * La **task 777** resta **rossa** con badge â€œ**straordinaria**â€ in timeline.
> * La chip mostra lâ€™`operation_id` (es. â€œ2â€) senza testo.
> * Nel popup continua a mostrare â€œnon migratoâ€ se non confermata.
