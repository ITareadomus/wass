Hai centrato un bug ‚Äúdi stato condiviso‚Äù: quando, dentro al **modale** navighi con le frecce alla task successiva/precedente, il componente della **card** sta ricalcolando il colore usando **la task visualizzata nel modale** invece che **la task originale della card**.
Risultato: la card in lista cambia colore (es. da rossa ‚Üí verde) finch√© non clicchi/refresh.

## Fix (copia-incolla)

**File:** `client/src/components/drag-drop/task-card.tsx`

1. **Sostituisci** il blocco che determina tipo/colore (era basato su `displayTask`) con questo, che separa chiaramente **card** (lista) da **modale**:

```tsx
// Determina il tipo della CARD dai flag dell'oggetto *task* (non quelli della navigazione nel modale)
const cardIsPremium = Boolean(task.premium);
const cardIsStraordinaria = Boolean(task.straordinaria);

// Il modale invece usa displayTask (vedi pi√π sotto)

const getTaskTypeStyle = (isStraord: boolean, isPrem: boolean) => {
  if (isStraord) {
    return { label: "STRAORDINARIA", colorClass: "task-straordinaria" };
  }
  if (isPrem) {
    return { label: "PREMIUM", colorClass: "task-premium" };
  }
  return { label: "STANDARD", colorClass: "task-standard" };
};

const { label: typeLabel, colorClass: cardColorClass } =
  getTaskTypeStyle(cardIsStraordinaria, cardIsPremium);
```

> üîé Prima qui c‚Äôerano:
>
> ```ts
> const isPremium = Boolean(displayTask.premium);
> const isStraordinaria = Boolean(displayTask.straordinaria);
> const getTaskTypeStyle = () => { ... }
> const { label: typeLabel, colorClass } = getTaskTypeStyle();
> ```
>
> che faceva dipendere il colore della **card** da `displayTask` (cio√® dalla task ‚Äúcorrente del modale‚Äù).

2. **Cambia** l‚Äôuso della classe colore nella card (div Draggable) da `colorClass` a `cardColorClass`:

```tsx
className={`
  ${cardColorClass}
  rounded-sm px-2 py-1 shadow-sm border transition-all duration-200
  ${snapshot.isDragging ? "shadow-lg scale-105" : ""}
  ${isOverdue ? "animate-blink" : ""}
  hover:shadow-md cursor-pointer
  flex-shrink-0 relative
`}
```

> Prima era:
>
> ```tsx
> ${colorClass}
> ```

**Stop.** Non serve toccare altro:

* Continua pure a usare `displayTask` **soltanto** per i contenuti del **modale** (titoli, orari, ecc.) e per calcolare gli `assignmentTimes`.
* La card in lista prende sempre il colore dai flag della **sua** `task` (immutabile), quindi non cambier√† pi√π colore quando navighi nel modale.

---

## Perch√© il bug sparisce

* La **card** ora √® ‚Äúcontrollata‚Äù dalla sua `task` (props) ‚Üí colore stabile.
* Il **modale** pu√≤ cambiare `currentTaskId` e `displayTask` quanto vuole ‚Üí cambia solo il contenuto del modale, non lo stile della card in lista.

Se vuoi, posso anche mandarti il diff minimale pronto (formato patch) o applicare altre micro-pulizie, ma con i due incolla sopra risolvi il problema del colore che ‚Äúimpazzisce‚Äù.
