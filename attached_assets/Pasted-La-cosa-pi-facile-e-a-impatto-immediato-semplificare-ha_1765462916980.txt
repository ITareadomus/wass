La cosa pi√π facile e a impatto immediato √® semplificare handleResetAssignments.

Oggi (semplificando) fai:

const handleResetAssignments = async () => {
  const resetResponse = await apiRequest("POST", "/api/reset-timeline-assignments", {...});

  const containersResponse = await fetch(`/api/containers?date=${workDate}`, ...);
  const timelineResponse   = await fetch(`/api/timeline?date=${workDate}`, ...);

  if (containersResponse.ok && timelineResponse.ok) {
    if ((window as any).reloadAllTasks) {
      await (window as any).reloadAllTasks();
    }
    if ((window as any).setHasUnsavedChanges) {
      (window as any).setHasUnsavedChanges(true);
    }
    await loadTimelineData();
    toast(...);
  } else {
    throw new Error(...);
  }
};


Quella parte con fetch containers e fetch timeline √® inutile, perch√©:

reloadAllTasks() richiama gi√† tutta la logica di refresh (containers + assegnazioni),

loadTimelineData() richiama di nuovo /api/timeline.

üëâ Puoi fare cos√¨ (versione pi√π snella):

const [isResetting, setIsResetting] = useState(false);

const handleResetAssignments = async () => {
  try {
    setIsResetting(true);

    const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');

    await apiRequest("POST", "/api/reset-timeline-assignments", {
      date: workDate,
      modified_by: currentUser.username || 'unknown'
    });

    // Svuota subito la timeline in UI, cos√¨ l'utente vede l'effetto
    setTimelineData(null);
    (window as any).setHasUnsavedChanges?.(true);

    // Una SOLA pipeline di reload dei dati
    await (window as any).reloadAllTasks?.();
    await loadTimelineData();

    toast({
      title: "Reset completato",
      description: "Timeline svuotata, task tornate nei containers",
      variant: "success",
    });
  } catch (error) {
    console.error('Errore nel reset:', error);
    toast({
      title: "Errore",
      description: "Errore durante il reset delle assegnazioni",
      variant: "destructive",
    });
  } finally {
    setIsResetting(false);
  }
};


E nel bottone:

<Button
  variant="outline"
  size="sm"
  disabled={!hasTasksInTimeline || isResetting}
  onClick={() => setShowResetDialog(true)}
>
  {isResetting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
  Reset Assegnazioni
</Button>


Effetti pratici:

meno chiamate al backend dopo il reset (niente doppio fetch containers/timeline)

feedback immediato: svuoti la timeline in UI prima che tutto il giro di refresh sia finito

niente ‚Äúclick ‚Üí 3‚Äì4 secondi di silenzio‚Äù, ma ‚Äúclick ‚Üí timeline vuota + spinner‚Äù